{"source":2,"revision":63,"description":null,"createdBy":{"displayName":"Gavin Wakeley","url":"https://spsprodweu1.vssps.visualstudio.com/Aaebfcc9a-9c3e-4109-b681-c988cb101ef3/_apis/Identities/5287972f-7080-604d-8474-5742a0f5e286","_links":{"avatar":{"href":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"}},"id":"5287972f-7080-604d-8474-5742a0f5e286","uniqueName":"GAWA2@hscic.gov.uk","imageUrl":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2","descriptor":"aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"},"createdOn":"2020-11-17T11:09:20.720Z","modifiedBy":{"displayName":"Gavin Wakeley","url":"https://spsprodweu1.vssps.visualstudio.com/Aaebfcc9a-9c3e-4109-b681-c988cb101ef3/_apis/Identities/5287972f-7080-604d-8474-5742a0f5e286","_links":{"avatar":{"href":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"}},"id":"5287972f-7080-604d-8474-5742a0f5e286","uniqueName":"GAWA2@hscic.gov.uk","imageUrl":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2","descriptor":"aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"},"modifiedOn":"2020-12-08T13:32:05.437Z","isDeleted":false,"lastRelease":{"id":2708,"name":"Release 063 for build 20201130.5 nhs-digital-gp-it-futures.platform-tf","artifacts":[],"_links":{},"description":"","releaseDefinition":{"id":32,"projectReference":null,"_links":{}},"createdOn":"2020-12-01T15:42:23.260Z","createdBy":{"displayName":"Gavin Wakeley","url":"https://spsprodweu1.vssps.visualstudio.com/Aaebfcc9a-9c3e-4109-b681-c988cb101ef3/_apis/Identities/5287972f-7080-604d-8474-5742a0f5e286","_links":{"avatar":{"href":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"}},"id":"5287972f-7080-604d-8474-5742a0f5e286","uniqueName":"GAWA2@hscic.gov.uk","imageUrl":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2","descriptor":"aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"}},"variables":{"firstRun":{"value":"No"},"runDeployBC":{"value":"true","allowOverride":true},"runPrepareEnv":{"value":"true","allowOverride":true},"runTerraform":{"value":"true","allowOverride":true},"System.Debug":{"value":"false"},"tfVersion":{"value":"0.13.5"}},"variableGroups":[],"environments":[{"id":134,"name":"Development Deploy","rank":1,"owner":{"displayName":"Gavin Wakeley","url":"https://spsprodweu1.vssps.visualstudio.com/Aaebfcc9a-9c3e-4109-b681-c988cb101ef3/_apis/Identities/5287972f-7080-604d-8474-5742a0f5e286","_links":{"avatar":{"href":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"}},"id":"5287972f-7080-604d-8474-5742a0f5e286","uniqueName":"GAWA2@hscic.gov.uk","imageUrl":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2","descriptor":"aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"},"variables":{"coreURLDev":{"value":"dev.buyingcatalogue.digital.nhs.uk"},"runTestsDev":{"value":"true","allowOverride":true}},"variableGroups":[20],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":670}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":671},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":672}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-18.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":164,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"eq(variables.runTerraform, true)","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Update Infrastructure from Terraform","refName":null,"workflowTasks":[{"environment":{},"taskId":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","version":"3.*","name":"Confirm Branch Name","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"shortBranchName=\"development\"\necho \"##vso[task.setvariable variable=release]$shortBranchName\"\necho Calculated branch name is: $shortBranchName","workingDirectory":"","failOnStderr":"false","noProfile":"true","noRc":"true"}},{"environment":{},"taskId":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","version":"3.*","name":"Check Folders","refName":"","enabled":false,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"ls -R","workingDirectory":"./","failOnStderr":"false","noProfile":"true","noRc":"true"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Disable Enhanced SA Security","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"# Disable Terraform firewall\naz storage account update --resource-group gpitfutures-rg-sa --name gpitfuturessatf --default-action Allow >/dev/null\n\n# Check and Disable storage account firewall\nstorageAccount=$(az storage account show --resource-group gpitfutures-development-rg-sa --name gpitfuturesdevelopment >/dev/null)\n\nif [ -n \"$storageAccount\" ]; then  \n   az storage account update --resource-group gpitfutures-development-rg-sa --name gpitfuturesdevelopment --default-action Allow >/dev/null\nfi\n\necho \"wait  60 seconds to apply SA Firewall Disables\"\nping -c 60 127.0.0.1 >/dev/null","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform $(tfversion)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"$(tfversion)"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Initialise (Key Vault)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/generateKeyVault","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.development.keyvault.terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Plan (Key Vault)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"plan","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/generateKeyVault","commandOptions":"-var=\"environment=$(release)\" -var=\"keyvault=gpit-$(release)-kv\" -var=\"keyvaultrg=$(release)-kv-rg\" -var=\"kv_addrprefix=10.250\" -var=\"kv_sqlusername=gpitfbcadmin\" -var=\"kv_coreurl=$(release).$(coreURLDev)\" -var=\"region=uksouth\" -var=\"subscription_id=7b12a8a2-f06f-456f-b6f9-aa2d92e0b2ec\" -var=\"tenant_id=50f6071f-bbfe-401a-8803-673748e629e2\" -var=\"pjtcode=gpit\" -var=\"project=gpitfutures\"","environmentServiceNameAzureRM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.development.keyvault.terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Apply (Key Vault)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/generateKeyVault","commandOptions":"-var=\"environment=$(release)\" -var=\"keyvault=gpit-$(release)-kv\" -var=\"keyvaultrg=$(release)-kv-rg\" -var=\"kv_addrprefix=10.250\" -var=\"kv_sqlusername=gpitfbcadmin\" -var=\"kv_coreurl=$(release).$(coreURLDev)\" -var=\"region=uksouth\" -var=\"subscription_id=7b12a8a2-f06f-456f-b6f9-aa2d92e0b2ec\" -var=\"tenant_id=50f6071f-bbfe-401a-8803-673748e629e2\" -var=\"pjtcode=gpit\" -var=\"project=gpitfutures\"","environmentServiceNameAzureRM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.development.keyvault.terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Initialise (Branch Environment)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/terraform","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.development.terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Plan (Branch Environment)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"plan","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/terraform","commandOptions":"-var=\"environment=$(release)\" -var=\"keyvault=gpit-$(release)-kv\" -var=\"keyvaultrg=$(release)-kv-rg\" -var=\"region=uksouth\" -var=\"subscription_id=7b12a8a2-f06f-456f-b6f9-aa2d92e0b2ec\" -var=\"tenant_id=50f6071f-bbfe-401a-8803-673748e629e2\" -var=\"pjtcode=gpit\" -var=\"project=gpitfutures\"","environmentServiceNameAzureRM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.development.keyvault.terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Apply (Branch Environment)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"apply","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/terraform","commandOptions":"-var=\"environment=$(release)\" -var=\"keyvault=gpit-$(release)-kv\" -var=\"keyvaultrg=$(release)-kv-rg\" -var=\"region=uksouth\" -var=\"subscription_id=7b12a8a2-f06f-456f-b6f9-aa2d92e0b2ec\" -var=\"tenant_id=50f6071f-bbfe-401a-8803-673748e629e2\" -var=\"pjtcode=gpit\" -var=\"project=gpitfutures\"","environmentServiceNameAzureRM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.development.keyvault.terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Enabkle Enhanced SA Security copy","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"# Enables Terraform firewall\naz storage account update --resource-group gpitfutures-rg-sa --name gpitfuturessatf --default-action Deny >/dev/null\n\n# Enables storage account firewall\naz storage account update --resource-group gpitfutures-development-rg-sa --name gpitfuturesdevelopment --default-action Deny >/dev/null\n\necho \"wait  60 seconds to apply SA Firewall Enables\"\nping -c 60 127.0.0.1 >/dev/null","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}}]},{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-18.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":164,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"and(succeeded(), eq(variables.runPrepareEnv, true))","overrideInputs":{}},"rank":2,"phaseType":1,"name":"Prepare AKS Cluster","refName":null,"workflowTasks":[{"environment":{},"taskId":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","version":"3.*","name":"Confirm Branch Name","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"shortBranchName=\"development\"\necho \"##vso[task.setvariable variable=release]$shortBranchName\"\necho Calculated branch name is: $shortBranchName","workingDirectory":"","failOnStderr":"false","noProfile":"true","noRc":"true"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Get Kubernetes Context","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az aks get-credentials -n gpitfutures-$(release)-aks -g gpitfutures-$(release)-rg-aks","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/","failOnStandardError":"true","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Disable Enhanced AKS Firewall","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az aks update -n gpitfutures-development-aks -g gpitfutures-development-rg-aks --api-server-authorized-ip-ranges \"\" > /dev/null","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","version":"3.*","name":"Check if First Run","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"echo \"Checking if this is first run...\"\nagNamespace=$(kubectl get namespace ingress-appgw)\nif [[ -z \"$agNamespace\" ]]; then\n    echo \"First Run\"\n    echo \"##vso[task.setvariable variable=firstRun]Yes\" #set variable firstRun to Yes\nelse\n    echo \"Not First Run\"\n    echo \"##vso[task.setvariable variable=firstRun]No\" #set variable firstRun to No\nfi ","workingDirectory":"","failOnStderr":"false","noProfile":"true","noRc":"true"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Setup Ingress Namespace","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.firstRun, 'Yes'))","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"kubectl create namespace ingress-appgw\nkubectl create -f ./ingress/deployment-rbac.yaml\naz identity list -g gpitfutures-$(release)-rg-aks -o json > ./ingress/$(release)-msi.txt","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/","failOnStandardError":"true","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Setup Azure AD Integration","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.firstRun, 'Yes'))","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"release=$(release)\n      \naadClientId=$(az identity list --query \"[?name=='gpitfutures-$release-aad-id'].clientId\" -o tsv)\naadIdPath=$(az identity list --query \"[?name=='gpitfutures-$release-aad-id'].id\" -o tsv)\naksSpId=$(az aks list -g gpitfutures-$release-rg-aks --query \"[?name=='gpitfutures-$release-aks'].servicePrincipalProfile.clientId\" -o tsv)\naksFqdn=$(az aks list -g gpitfutures-$release-rg-aks --query \"[?name=='gpitfutures-$release-aks'].fqdn\" -o tsv)\nappgwId=$(az network application-gateway list --query \"[?name=='gpitfutures-$release-appgw'].id\" -o tsv)\nappgwRgName=$(az network application-gateway list --query \"[?name=='gpitfutures-$release-appgw'].resourceGroup\" -o tsv)\nappgwRgId=$(az group list --query \"[?name=='gpitfutures-$release-rg-appgw'].id\" -o tsv)\nsubId=$(az account list --query \"[?name=='GP IT Futures Buying Catalogue'].id\" -o tsv --all)\n\ncat ./ingress/aadpodidentity-template.txt | sed -e \"s*\\${name}*gpitfutures-$(release)-aad-id*\" | sed -e \"s*\\${idPath}*$aadIdPath*\" | sed -e \"s*\\${clientID}*$aadClientId*\" > ./ingress/$(release)-aadpodidentity.yaml\n\ncat ./ingress/aadpodidentitybinding-template.txt  | sed -e \"s*\\${name}*gpitfutures-$(release)-aad-id*\" | sed -e \"s*\\${clientID}*$aadClientId*\" > ./ingress/$(release)-aadpodidentitybinding.yaml\n\nkubectl apply -f ./ingress/$(release)-aadpodidentity.yaml -n ingress-appgw\n\nkubectl apply -f ./ingress/$(release)-aadpodidentitybinding.yaml -n ingress-appgw\n\naz role assignment create --role \"Managed Identity Operator\" --assignee $aksSpId --scope $aadIdPath","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/","failOnStandardError":"true","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"068d5909-43e6-48c5-9e01-7c8a94816220","version":"0.*","name":"Install Helm latest","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.firstRun, 'Yes'))","inputs":{"helmVersion":"latest","checkLatestHelmVersion":"true","installKubeCtl":"true","kubectlVersion":"1.8.9","checkLatestKubeCtl":"true"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Setup Application Gateway Ingress Controller","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.firstRun, 'Yes'))","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"release=$(release)\nagicshared=\"true\"\n\nsubId=$(az account list --query \"[?name=='GP IT Futures Buying Catalogue'].id\" -o tsv --all)\nappgwRgName=$(az network application-gateway list --query \"[?name=='gpitfutures-$release-appgw'].resourceGroup\" -o tsv)\naadIdPath=$(az identity list --query \"[?name=='gpitfutures-$release-aad-id'].id\" -o tsv)\naadClientId=$(az identity list --query \"[?name=='gpitfutures-$release-aad-id'].clientId\" -o tsv)\naksFqdn=$(az aks list -g gpitfutures-$release-rg-aks --query \"[?name=='gpitfutures-$release-aks'].fqdn\" -o tsv)\n\ncat ./ingress/helm-agic-config-template.txt | sed -e \"s*\\${subId}*$subId*\" | sed -e \"s*\\${appgwRg}*$appgwRgName*\" | sed -e \"s*\\${appgwName}*gpitfutures-$release-appgw*\" | sed -e \"s*\\${aadId}*$aadIdPath*\" | sed -e \"s*\\${clientId}*$aadClientId*\" | sed -e \"s*\\${apiAddress}*$aksFqdn*\" | sed -e \"s*\\${shared}*$agicshared*\" > ./ingress/$release-helm-config.yaml\n\nhelm repo add application-gateway-kubernetes-ingress https://appgwingress.blob.core.windows.net/ingress-azure-helm-package/\n      helm repo update\n\nhelm install ingress-azure -f ./ingress/$(release)-helm-config.yaml application-gateway-kubernetes-ingress/ingress-azure -n ingress-appgw --version 1.2.0-rc3\n\nkubectl apply -f https://raw.githubusercontent.com/Azure/application-gateway-kubernetes-ingress/ae695ef9bd05c8b708cedf6ff545595d0b7022dc/crds/AzureIngressProhibitedTarget.yaml","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Configure AGIC Prohibited Targets","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.firstRun, 'Yes'))","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"release=$(release)\nagicCrdURL=\"www.$(release).$(coreURLDev)\"\nagicCrdName=$(echo $agicCrdURL | tr \".\" -)\n\ncat ./ingress/azureingressprohibitedtarget.txt | sed -e \"s*\\${PTname}*$agicCrdName*\" | sed -e \"s*\\${URL}*$agicCrdURL*\" > ./ingress/www-$release-azureingressprohibitedtarget.yaml\n\nagicCrdURLRancher=\"rancher-$(release).$(coreURLDev)\"\nagicCrdNameRancher=$(echo $agicCrdURL | tr \".\" -)\n\ncat ./ingress/azureingressprohibitedtarget.txt | sed -e \"s*\\${PTname}*$agicCrdNameRancher*\" | sed -e \"s*\\${URL}*$agicCrdURLRancher*\" > ./ingress/rancher-$release-azureingressprohibitedtarget.yaml\n      \nkubectl apply -f ./ingress/www-$release-azureingressprohibitedtarget.yaml -n ingress-appgw\nkubectl apply -f ./ingress/rancher-$release-azureingressprohibitedtarget.yaml -n ingress-appgw\nkubectl delete AzureIngressProhibitedTarget prohibit-all-targets -n ingress-appgw","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/","failOnStandardError":"true","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Setup Rancher","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.firstRun, 'Yes'))","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"helm repo add rancher-stable https://releases.rancher.com/server-charts/stable\nhelm repo update\n\nkubectl create namespace cattle-system\n\nhelm install rancher rancher-stable/rancher --namespace cattle-system --set hostname=rancher-$(release).$(coreURLDev) --set tls=external","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/","failOnStandardError":"true","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Enables Enhanced AKS Firewall","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.runDeployBC, false))","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"ipRange=$(az keyvault secret show --vault-name gpitfutures-dev-core-kv --name \"gpitdevbjssvpn\" --query value -o tsv)\naz aks update -n gpitfutures-development-aks -g gpitfutures-development-rg-aks --api-server-authorized-ip-ranges \"$ipRange\" > /dev/null","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}}]},{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-18.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":164,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"and(succeeded(), eq(variables.runDeployBC, true))","overrideInputs":{}},"rank":3,"phaseType":1,"name":"Deploy Buying Catalogue","refName":null,"workflowTasks":[{"environment":{},"taskId":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","version":"3.*","name":"Confirm Branch Name","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"shortBranchName=\"development\"\necho \"##vso[task.setvariable variable=release]$shortBranchName\"\necho Calculated branch name is: $shortBranchName","workingDirectory":"","failOnStderr":"false","noProfile":"true","noRc":"true"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Get Kubernetes Context","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az aks get-credentials -n gpitfutures-$(release)-aks -g gpitfutures-$(release)-rg-aks","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/","failOnStandardError":"true","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Disable Enhanced AKS Firewall","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.runPrepareEnv, false))","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"az aks update -n gpitfutures-development-aks -g gpitfutures-development-rg-aks --api-server-authorized-ip-ranges \"\" > /dev/null","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"61f2a582-95ae-4948-b34d-a1b3c4f6a737","version":"2.*","name":"Download Platform Helm Artifact","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"source":"specific","project":"c5f97979-5b03-4d10-ba8d-871d0526b408","pipeline":"75","preferTriggeringPipeline":"false","runVersion":"latestFromBranch","runBranch":"refs/heads/master","runId":"","tags":"","allowPartiallySucceededBuilds":"false","allowFailedBuilds":"false","artifact":"","patterns":"**","path":"$(System.ArtifactsDirectory)/_nhs-digital-gp-it-futures.platform-helm"}},{"environment":{},"taskId":"068d5909-43e6-48c5-9e01-7c8a94816220","version":"0.*","name":"Install Helm latest","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"helmVersion":"latest","checkLatestHelmVersion":"true","installKubeCtl":"true","kubectlVersion":"1.8.9","checkLatestKubeCtl":"true"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Setup Helm Repos","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"acr=\"gpitfuturesdevacr\"\n\nacrUsername=$(az acr credential show --name $acr --query username -o tsv)\nacrPassword=$(az acr credential show --name $acr --query passwords[0].value -o tsv)\nacrLoginSvr=$(az acr list --query \"[?name=='$acr'].loginServer\" -o tsv)\n\nhelm repo add $acr https://$acrLoginSvr/helm/v1/repo --username $acrUsername --password $acrPassword\nhelm repo add stable https://charts.helm.sh/stable/\nhelm repo update","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"./_nhs-digital-gp-it-futures.platform-helm/build-artifact/","failOnStandardError":"true","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","version":"3.*","name":"Setup Selenium Grid","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.runTestsDev, true))","inputs":{"targetType":"inline","filePath":"","arguments":"","script":"chmod +x ./launch-selenium-grid.sh\n\nrelease=$(release)\n\nbash launch-selenium-grid.sh --add \"$release.$(coreURLdev).\"","workingDirectory":"./_nhs-digital-gp-it-futures.platform-helm/build-artifact/selenium-grid","failOnStderr":"false","noProfile":"true","noRc":"true"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Deploy System","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"release=$(release)\nreleaseNoPunct=$(echo $release | sed -e 's/-//g')\nhelmChartVersion=$(jq .helmChartVersion ./variables.json -r)\n\nsqlDbAdminUser=$(az sql server list --query \"[?name=='gpitfutures-$release-sql-pri'].administratorLogin\" -o tsv)\n\nsqlDbAdminPass=$(az keyvault secret show --vault-name gpit-$release-kv --name \"gpit${releaseNoPunct}sqladminpassword\" --query value -o tsv)\n\nsaConnectionString=$(az storage account show-connection-string --name gpitfutures${releaseNoPunct} --resource-group gpitfutures-$release-rg-sa --query connectionString -o tsv)\n\nappgwPip=$(az network public-ip show --name gpitfutures-$release-pip --resource-group gpitfutures-$release-rg-appgw --query ipAddress -o tsv)\n\nredisHost=$(az redis show --resource-group gpitfutures-dev-core-rg-redis --name gpitfutures-dev-core-redis --query hostName -o tsv)\n\nredisPass=$(az redis list-keys --resource-group gpitfutures-dev-core-rg-redis --name gpitfutures-dev-core-redis --query primaryKey -o tsv)\n          \n\nchmod +x ./launch-or-update-azure.sh\n\n./launch-or-update-azure.sh \\\n-c remote \\\n-n development \\\n-d gpitfutures-development-sql-pri.database.windows.net \\\n-u $sqlDbAdminUser \\\n-p $sqlDbAdminPass \\\n--base-path \"$(release).$(coreURLDev)\" \\\n-w true \\\n-v $helmChartVersion \\\n-s \"/p:DatabaseEdition=Standard /p:DatabaseServiceObjective=S0\" \\\n-a \"$saConnectionString\" \\\n-i \"$appgwPip\" \\\n-r $redisHost \\\n-q $redisPass \\\n--cookie-secret=$(srt-cookiesecret) \\\n--client-secret=$(srt-clientsecret) \\\n--db-user-pass=$(srt-sqldevdbpass) \\\n-f \"azure-dev.yaml\"","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"./_nhs-digital-gp-it-futures.platform-helm/build-artifact/","failOnStandardError":"true","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Add Rancher Backend Nodes","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"ipArr=()\nipArr+=$(kubectl get pods -l app=rancher -n cattle-system -o wide | while read line ; do while read a b c d e ip g h i; do echo $ip ; done ; done)\naz network application-gateway address-pool update -g gpitfutures-$(release)-rg-appgw --gateway-name gpitfutures-$(release)-appgw -n rancher --servers $ipArr  ","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"./_nhs-digital-gp-it-futures.platform-helm/build-artifact/","failOnStandardError":"true","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","version":"3.*","name":"Wait for tests to complete","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.runTestsDev, true))","inputs":{"targetType":"inline","filePath":"ping -c 240 127.0.0.1","arguments":"","script":"ping -c 240 127.0.0.1","workingDirectory":"./_nhs-digital-gp-it-futures.platform-helm/build-artifact/","failOnStderr":"false","noProfile":"true","noRc":"true"}},{"environment":{},"taskId":"6c731c3c-3c68-459a-a5c9-bde6e6595b5b","version":"3.*","name":"Grab test results","refName":"","enabled":true,"alwaysRun":false,"continueOnError":true,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.runTestsDev, true))","inputs":{"targetType":"inline","filePath":"ping -c 240 127.0.0.1","arguments":"","script":"chmod +x ./get-test-results.sh\n\nhelmChartVersion=$(jq .helmChartVersion ./variables.json -r)\nrelease=$(release)\n\n./get-test-results.sh -v $helmChartVersion -n $release","workingDirectory":"./_nhs-digital-gp-it-futures.platform-helm/build-artifact/","failOnStderr":"false","noProfile":"true","noRc":"true"}},{"environment":{},"taskId":"0b0f01ed-7dde-43ff-9cbb-e48954daf9b1","version":"2.*","name":"Acceptance test results","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), eq(variables.runTestsDev, true))","inputs":{"testRunner":"VSTest","testResultsFiles":"**/*.trx","searchFolder":"$(System.DefaultWorkingDirectory)","mergeTestResults":"true","failTaskOnFailedTests":"false","testRunTitle":"Acceptance test results (Dynamic Dev)","platform":"","configuration":"","publishRunAttachments":"true"}},{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Enables Enhanced AKS Firewall","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"ipRange=$(az keyvault secret show --vault-name gpitfutures-dev-core-kv --name \"gpitdevbjssvpn\" --query value -o tsv)\naz aks update -n gpitfutures-development-aks -g gpitfutures-development-rg-aks --api-server-authorized-ip-ranges \"$ipRange\" > /dev/null","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":2708,"url":"https://buyingcatalog.vsrm.visualstudio.com/c5f97979-5b03-4d10-ba8d-871d0526b408/_apis/Release/releases/2708","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://buyingcatalog.vsrm.visualstudio.com/_apis/public/Release/badge/c5f97979-5b03-4d10-ba8d-871d0526b408/32/134"},{"id":136,"name":"Dynamic TF Plan","rank":2,"owner":{"displayName":"Gavin Wakeley","url":"https://spsprodweu1.vssps.visualstudio.com/Aaebfcc9a-9c3e-4109-b681-c988cb101ef3/_apis/Identities/5287972f-7080-604d-8474-5742a0f5e286","_links":{"avatar":{"href":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"}},"id":"5287972f-7080-604d-8474-5742a0f5e286","uniqueName":"GAWA2@hscic.gov.uk","imageUrl":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2","descriptor":"aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":681}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":676},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":677}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-18.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":164,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Calculate Branch Name","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"# Get all branches\nlistAks=$(az aks list --query \"[?contains(name, 'feature')].[name]\" -o tsv)\n\nif [ \"$listAks\" ]; then \n   # Select top branch for deletion\n   shortBranchName=$(echo $listAks | cut -c13- | rev | cut -c5- | rev)\n   echo \"Calculated branch name is: $shortBranchName\"\n   echo \"##vso[task.setvariable variable=release]$shortBranchName\"\nelse\n   echo \"No Branch Found, exiting.\"\n   exit 0\nfi","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform $(tfVersion)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"$(tfVersion)"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Initialise (Branch Environment)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/terraform","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.$(release).terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Plan (Branch Environment)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"plan","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/terraform","commandOptions":"-var=\"environment=$(release)\" -var=\"keyvault=gpit-$(release)-kv\" -var=\"keyvaultrg=$(release)-kv-rg\" -var=\"region=uksouth\" -var=\"subscription_id=7b12a8a2-f06f-456f-b6f9-aa2d92e0b2ec\" -var=\"tenant_id=50f6071f-bbfe-401a-8803-673748e629e2\" -var=\"pjtcode=gpit\" -var=\"project=gpitfutures\"","environmentServiceNameAzureRM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.$(release).terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Initialise (Key Vault)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/generateKeyVault","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.$(release).keyvault.terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Plan (Key Vault)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"plan","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/generateKeyVault","commandOptions":"-var=\"environment=$(release)\" -var=\"keyvault=gpit-$(release)-kv\" -var=\"keyvaultrg=$(release)-kv-rg\" -var=\"kv_addrprefix=10.201\" -var=\"kv_sqlusername=gpitfbcadmin\" -var=\"kv_coreurl=$(release).dynamic.buyingcatalogue.digital.nhs.uk\" -var=\"region=uksouth\" -var=\"subscription_id=7b12a8a2-f06f-456f-b6f9-aa2d92e0b2ec\" -var=\"tenant_id=50f6071f-bbfe-401a-8803-673748e629e2\" -var=\"pjtcode=gpit\" -var=\"project=gpitfutures\"","environmentServiceNameAzureRM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.$(release).terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":2708,"url":"https://buyingcatalog.vsrm.visualstudio.com/c5f97979-5b03-4d10-ba8d-871d0526b408/_apis/Release/releases/2708","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://buyingcatalog.vsrm.visualstudio.com/_apis/public/Release/badge/c5f97979-5b03-4d10-ba8d-871d0526b408/32/136"},{"id":137,"name":"Dynamic TF Destroy","rank":3,"owner":{"displayName":"Gavin Wakeley","url":"https://spsprodweu1.vssps.visualstudio.com/Aaebfcc9a-9c3e-4109-b681-c988cb101ef3/_apis/Identities/5287972f-7080-604d-8474-5742a0f5e286","_links":{"avatar":{"href":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"}},"id":"5287972f-7080-604d-8474-5742a0f5e286","uniqueName":"GAWA2@hscic.gov.uk","imageUrl":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2","descriptor":"aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":false,"isNotificationOn":false,"approver":{"displayName":"Gavin Wakeley","url":"https://spsprodweu1.vssps.visualstudio.com/Aaebfcc9a-9c3e-4109-b681-c988cb101ef3/_apis/Identities/5287972f-7080-604d-8474-5742a0f5e286","_links":{"avatar":{"href":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"}},"id":"5287972f-7080-604d-8474-5742a0f5e286","uniqueName":"GAWA2@hscic.gov.uk","imageUrl":"https://buyingcatalog.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2","descriptor":"aad.NTI4Nzk3MmYtNzA4MC03MDRkLTg0NzQtNTc0MmEwZjVlMjg2"},"id":682}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":10080,"executionOrder":1}},"deployStep":{"id":683},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":684}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"agentSpecification":{"identifier":"ubuntu-18.04"},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[]},"queueId":164,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Agent job","refName":null,"workflowTasks":[{"environment":{},"taskId":"46e4be58-730b-4389-8a2f-ea10b3e5e815","version":"2.*","name":"Calculate Branch Name","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"connectedServiceNameARM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","scriptType":"bash","scriptLocation":"inlineScript","scriptPath":"","inlineScript":"# Get all branches\nlistAks=$(az aks list --query \"[?contains(name, 'feature')].[name]\" -o tsv)\n\nif [ \"$listAks\" ]; then \n   # Select top branch for deletion\n   shortBranchName=$(echo $listAks | cut -c13- | rev | cut -c5- | rev)\n   echo \"Calculated branch name is: $shortBranchName\"\n   echo \"##vso[task.setvariable variable=release]$shortBranchName\"\nelse\n   echo \"No Branch Found, exiting.\"\n   exit 0\nfi","scriptArguments":"","powerShellErrorActionPreference":"stop","addSpnToEnvironment":"false","useGlobalConfig":"false","cwd":"","failOnStandardError":"false","powerShellIgnoreLASTEXITCODE":"false"}},{"environment":{},"taskId":"a4789e5d-f6e8-431f-add9-379d640a883c","version":"0.*","name":"Install Terraform $(tfVersion)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"terraformVersion":"$(tfVersion)"}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Initialise (Branch Environment)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/terraform","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.$(release).terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Destroy (Branch Environment)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"destroy","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/terraform","commandOptions":"-var=\"environment=$(release)\" -var=\"keyvault=gpit-$(release)-kv\" -var=\"keyvaultrg=$(release)-kv-rg\" -var=\"region=uksouth\" -var=\"subscription_id=7b12a8a2-f06f-456f-b6f9-aa2d92e0b2ec\" -var=\"tenant_id=50f6071f-bbfe-401a-8803-673748e629e2\" -var=\"pjtcode=gpit\" -var=\"project=gpitfutures\"","environmentServiceNameAzureRM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.$(release).terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Initialise (Key Vault)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"init","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/generateKeyVault","commandOptions":"","environmentServiceNameAzureRM":"","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.$(release).keyvault.terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}},{"environment":{},"taskId":"fe504acc-6115-40cb-89ff-191386b5e7bf","version":"0.*","name":"Terraform Destroy (Key Vault)","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"provider":"azurerm","command":"destroy","workingDirectory":"./_nhs-digital-gp-it-futures.platform-tf/build-artifact/generateKeyVault","commandOptions":"-var=\"environment=$(release)\" -var=\"keyvault=gpit-$(release)-kv\" -var=\"keyvaultrg=$(release)-kv-rg\" -var=\"kv_addrprefix=10.201\" -var=\"kv_sqlusername=gpitfbcadmin\" -var=\"kv_coreurl=$(release).dynamic.buyingcatalogue.digital.nhs.uk\" -var=\"region=uksouth\" -var=\"subscription_id=7b12a8a2-f06f-456f-b6f9-aa2d92e0b2ec\" -var=\"tenant_id=50f6071f-bbfe-401a-8803-673748e629e2\" -var=\"pjtcode=gpit\" -var=\"project=gpitfutures\"","environmentServiceNameAzureRM":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","environmentServiceNameAWS":"","environmentServiceNameGCP":"","backendServiceArm":"ace76a07-acf8-4156-8f5e-73dbd3f1c911","backendAzureRmResourceGroupName":"gpitfutures-rg-sa","backendAzureRmStorageAccountName":"gpitfuturessatf","backendAzureRmContainerName":"tfstate","backendAzureRmKey":"gpit.$(release).terraform.tfstate","backendServiceAWS":"","backendAWSBucketName":"","backendAWSKey":"","backendServiceGCP":"","backendGCPBucketName":"","backendGCPPrefix":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"Dynamic TF Plan","conditionType":2,"value":"4"}],"executionPolicy":{"concurrencyCount":1,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":2708,"url":"https://buyingcatalog.vsrm.visualstudio.com/c5f97979-5b03-4d10-ba8d-871d0526b408/_apis/Release/releases/2708","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{"BoardsEnvironmentType":{"$type":"System.String","$value":"unmapped"},"LinkBoardsWorkItems":{"$type":"System.String","$value":"False"}},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://buyingcatalog.vsrm.visualstudio.com/_apis/public/Release/badge/c5f97979-5b03-4d10-ba8d-871d0526b408/32/137"}],"artifacts":[{"sourceId":"c5f97979-5b03-4d10-ba8d-871d0526b408:80","type":"Build","alias":"_nhs-digital-gp-it-futures.platform-tf","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://buyingcatalog.visualstudio.com/_permalink/_build/index?collectionId=8901e1e6-f6b4-405e-8311-81c753536136&projectId=c5f97979-5b03-4d10-ba8d-871d0526b408&definitionId=80","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"80","name":"nhs-digital-gp-it-futures.platform-tf"},"definitions":{"id":"","name":""},"IsMultiDefinitionType":{"id":"False","name":"False"},"project":{"id":"c5f97979-5b03-4d10-ba8d-871d0526b408","name":"Buying Catalogue"},"repository":{"id":"","name":""}},"isPrimary":true,"isRetained":false}],"triggers":[{"artifactAlias":"_nhs-digital-gp-it-futures.platform-tf","triggerConditions":[{"sourceBranch":"master","tags":[],"tagFilter":null,"useBuildDefinitionBranch":false,"createReleaseOnBuildTagging":false}],"triggerType":1}],"releaseNameFormat":"Release $(Rev:rrr) for build $(Build.BuildNumber) $(Build.DefinitionName)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"ReleaseNew"},"IntegrateJiraWorkItems":{"$type":"System.String","$value":"false"},"IntegrateBoardsWorkItems":{"$type":"System.String","$value":"False"}},"id":32,"name":"Platform-Infrastructure","path":"\\","projectReference":null,"url":"https://buyingcatalog.vsrm.visualstudio.com/c5f97979-5b03-4d10-ba8d-871d0526b408/_apis/Release/definitions/32","_links":{"self":{"href":"https://buyingcatalog.vsrm.visualstudio.com/c5f97979-5b03-4d10-ba8d-871d0526b408/_apis/Release/definitions/32"},"web":{"href":"https://buyingcatalog.visualstudio.com/c5f97979-5b03-4d10-ba8d-871d0526b408/_release?definitionId=32"}}}